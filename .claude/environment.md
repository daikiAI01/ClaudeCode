# 開発環境仕様書

このドキュメントは、外部AIツールやチームメンバーに開発環境を簡潔に説明するためのテンプレートです。

## 基本環境

- **OS**: macOS (Darwin 24.6.0)
- **開発ツール**: Claude Code（Anthropic CLI）
- **作業ディレクトリ**: `/Users/daikitakayama/code`
- **Git**: 非管理下（現在のディレクトリ）

## 接続MCPサーバー（8種類）

### 1. serena（セマンティックコード解析・編集）
- コードの構造解析、シンボル検索、精密な編集を担当
- ファイル全体を読む前に必要な部分だけを解析する効率的なアプローチ
- **優先度**: 最高 - すべてのコード操作で使用

### 2. memory（ナレッジグラフ）
- プロジェクト情報、アーキテクチャ、学習内容を記録・参照
- エンティティとリレーションによる知識管理
- **優先度**: 高 - 複雑なタスクで活用

### 3. filesystem
- ファイルシステム操作全般（ディレクトリツリー、ファイル検索など）
- serenaで対応できない場合に使用
- **優先度**: 中

### 4. playwright（ブラウザ自動化）
- Web UIのテスト、スクレイピング、自動化
- **優先度**: タスク依存

### 5. supabase
- Supabaseプロジェクトの管理・操作
- データベース操作、マイグレーション、Edge Functions
- **優先度**: タスク依存

### 6. sequential-thinking
- 複雑な問題の段階的思考
- アルゴリズム設計や多段階分析
- **優先度**: 中

### 7. ide
- IDE統合機能（診断情報、Jupyterコード実行）
- **優先度**: 中

### 8. **codex（AI駆動コード分析）** ⭐️重要
- 複雑なバグの根本原因分析
- アーキテクチャ設計のベストプラクティス提案
- パフォーマンス・セキュリティの詳細調査
- **優先度**: 高 - 自動起動ルールあり

## Codex自動起動ルール 🤖

以下の条件で**自動的に**Codexが起動されます：

1. ✅ バグ修正が3回以上失敗した場合
2. ✅ アーキテクチャ設計の相談
3. ✅ デバッグに30分以上かかっている場合
4. ✅ 複雑な技術的判断が必要な場合

## セキュリティポリシー

### 🟢 許可されている操作

- ファイル読み書き（`/Users/daikitakayama/**`）
- パッケージインストール（npm, pip, uv, brew）
- MCP操作全般（serena, memory, filesystem, playwright, sequential-thinking, ide, codex）
- Web検索、GitHub情報取得

### 🔴 禁止されている操作

- システム管理コマンド（sudo, rm, chmod, kill, shutdown）
- 外部ネットワーク（curl, wget, ssh, scp）
- データベース直接操作（psql, mysql, mongosh, sqlite3）
- パッケージアンインストール
- 機密ファイル（.env, secrets, token, key, ~/.ssh, ~/.gnupg）

### 🟡 確認が必要な操作

- Gitコミット・プッシュ操作
- パッケージ依存関係ファイルの変更（package.json, lockファイル）

## 推奨される開発フロー

### 通常の実装
```
要求 → serena（解析） → serena（編集） → memory（記録） → 完了
```

### 複雑なバグ修正
```
バグ報告 → 修正試行（1-3回） → 失敗 → Codex自動起動 → 解決策実装 → 完了
```

### アーキテクチャ設計
```
設計相談 → Codex分析 → 設計案提示 → 確認 → 実装
```

## 特徴・強み

1. **効率的なコード操作**: serenaによる精密なシンボルレベル編集
2. **知識の継続性**: memoryによる学習内容の永続化
3. **段階的エスカレーション**: 問題の複雑度に応じてCodexを自動起動
4. **セキュリティ重視**: 危険な操作は事前に制限・確認
5. **統合的アプローチ**: 8つのMCPを自動的に組み合わせて使用

## 使用上の注意

- Claude Codeは**自発的にMCPを選択**します（明示的な指示不要）
- 複雑な問題では**自動的にCodexが起動**します
- すべての重要な情報は**memoryに自動記録**されます
- セキュリティポリシーに違反する操作は**自動的に拒否**されます

---

**このテンプレートをコピーして、新しいAIツールでの相談時に提供してください。**
